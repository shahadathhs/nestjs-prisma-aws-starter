model FileInstance {
  id String @id @default(uuid())

  filename         String
  originalFilename String
  path             String
  url              String
  fileType         FileType @default(any)
  mimeType         String
  size             Int

  users           User[]
  privateMessages PrivateMessage[]
  
  // Add this relation
  mergeJob VideoMergeJob?

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@map("file_instances")
}

enum FileType {
  image
  docs
  link
  document
  any
  video
  audio
}

model VideoMergeJob {
  id String @id @default(uuid())

  jobId         String   @unique // AWS MediaConvert Job ID
  outputUrl     String   // S3 URL of the merged video
  outputFileId  String?  @unique // Reference to FileInstance after merge completes
  status        String   @default("SUBMITTED") // SUBMITTED, PROGRESSING, COMPLETE, ERROR, CANCELED
  errorMessage  String?  // Store error details if job fails
  sourceFileIds String[] // Array of FileInstance IDs that were merged

  outputFile FileInstance? @relation(fields: [outputFileId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@map("video_merge_jobs")
}